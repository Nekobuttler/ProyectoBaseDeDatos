--Aqui inician tablas atomicas 

/*Creación de la tabla de Sexo LISTO*/
CREATE TABLE TBsexo (
idSexo NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY, 
sexo varchar2(20) not null,
CONSTRAINT PK_IDSEXO PRIMARY KEY (IDSEXO));

/*Creación de la tabla de estado activo o inactivo LISTO*/
CREATE TABLE TBestado (
idEstado NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY, 
nombreEstado CHAR(1) not null,
CONSTRAINT tbEstadoPK PRIMARY KEY (idEstado));

/*Creación de la tabla Horario LISTO*/

CREATE TABLE TBHorario (
idHorario NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
dia DATE NOT NULL,
horaInicio VARCHAR2(8) NOT NULL,
horaFinal VARCHAR2(8) NOT NULL,
numLecciones NUMBER(2)NOT NULL ,
CONSTRAINT PK_IDHORARIO PRIMARY KEY(IDHORARIO));

--Duplicated
CREATE TABLE TBhorario(
idHorario NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
dia VARCHAR2(20) NOT NULL,
horaInicio TIMESTAMP(7) NOT NULL,
horaFin TIMESTAMP(7) NOT NULL,
numLecciones NUMBER NOT NULL,
CONSTRAINT pk_idHorario PRIMARY KEY(idHorario));

/*Creación de la tabla Encargado LISTO*/
CREATE TABLE  TBEncargado(
CedulaEncargado NUMBER not null ,  
NombreEncargado varchar2(20) not null,
ApellidosEncargado varchar2(20) not null, 
CorreoEncargado varchar2(20) not null,
NumTelefono NUMBER(8) not null,
Relacion varchar2(20) not null,
CONSTRAINT idcedulaEncargado_pk PRIMARY KEY (CedulaEncargado)
); 

/*Creacion de tabla Matería LISTO*/
CREATE TABLE TBMateria (
idMateria NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
nombreMateria VARCHAR2(50),
CONSTRAINT PK_IDMATERIA PRIMARY KEY (IDMATERIA));



--Aqui terminan las tablas atomicas

/*Creación de la tabla de correos de estudiantes LISTO*/
CREATE TABLE TBcorreoEstudiante (
idCorreoEstudiante NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY, 
correoEstudiante varchar2(30) not null, 
idEstudiante NUMBER not null, 
CONSTRAINT correosEst_pk PRIMARY KEY (idCorreoEstudiante));


/*Creación de la tabla de Estudiante LISTO*/

CREATE TABLE TBestudiante (
idEstudiante NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY, 
cedulaEstudiante VARCHAR2(9) not null, 
nombreEstudiante VARCHAR2 (20) not null,
apellidosEstudiante VARCHAR2 (50) not null,
fechaNacimiento DATE not null,
telefono NUMBER(8),
idSexo NUMBER not null,
fechaRegistro DATE not null,
idGrupo NUMBER not null, 
idEstado not null,
CONSTRAINT idEstudiante_pk1 PRIMARY KEY (idEstudiante)
);



/*Creación de la tabla relacion LISTO*/
CREATE TABLE TBrelacion (
idrelacion NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY, 
TipoRelacion VARCHAR2(20) not null, 
CedulaEncargado NUMBER NOT NULL,
idEstudiante NUMBER NOT NULL,
CONSTRAINT idrelacion_pk PRIMARY KEY (idrelacion)
);


/*Creación de la tabla profesor LISTO*/
CREATE TABLE TBprofesor(
idProfesor NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
cedulaProfesor NUMBER NOT NULL,
nombre VARCHAR2(25) NOT NULL,
apellidoPaterno VARCHAR2(50) NOT NULL,
apellidoMaterno VARCHAR2(50) NOT NULL,
fechaNaciemiento DATE NOT NULL,
telefono NUMBER NOT NULL,
correo VARCHAR2(80) NOT NULL,
idMateria NUMBER NOT NULL,
CONSTRAINT pk_idProfesor PRIMARY KEY(idProfesor));


/*Creacion de tabla Grupo LISTO*/
CREATE TABLE TBgrupo(
idGrupo NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
nombre VARCHAR2(25) NOT NULL,
cupo NUMBER NOT NULL,
nivel NUMBER NOT NULL,
CONSTRAINT pk_idGrupo PRIMARY KEY(idGrupo));


/*Creacion de tabla Profesores por Grupo LISTO*/
CREATE TABLE TBprofesoresPorGrupo(
idGrupo NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
idProfesor NUMBER NOT NULL,
CONSTRAINT pk_idGrupo1 PRIMARY KEY(idGrupo));



--Creación de Tabla Estado--
--Lo dejo por aquello de que quieran dividir la tabla Estado(asist) y Estado(estudia)
/*
CREATE TABLE TBestado_2(
idEstado NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
estado VARCHAR2(20) NOT NULL,
CONSTRAINT pk_idEstado PRIMARY KEY(idEstado));
*/




--Creación de Tabla Asistencia LISTO--
CREATE TABLE TBasistencia(
idAsistencia NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
fecha DATE NOT NULL,
horaInicio VARCHAR2(8) NOT NULL,
horaFin VARCHAR2(8) NOT NULL,
idEstado NUMBER,
CONSTRAINT pk_idAsistencia PRIMARY KEY(idAsistencia)
);

--Creación de Tabla Contacto LISTO--

CREATE TABLE TBcontacto(
idContacto NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
cedulaencargado NUMBER(9) not null, 
idEstudiante NUMBER not null,
idEncargado NUMBER NOT NULL,
CONSTRAINT pk_idContacto PRIMARY KEY(idContacto)
);

--Foreing Keys
ALTER TABLE TBcorreoEstudiante ADD CONSTRAINT idEstudiante_fk FOREIGN KEY (idEstudiante) REFERENCES TBestudiante (idEstudiante);
ALTER TABLE TBestudiante ADD CONSTRAINT idEstado_fk foreign KEY (idEstado) REFERENCES tbestado (idestado);
ALTER TABLE TBestudiante ADD CONSTRAINT idSexo_fk foreign KEY (idSexo) REFERENCES tbSexo (idSexo);
ALTER TABLE TBestudiante ADD CONSTRAINT idGrupo_fk FOREIGN KEY (idGrupo) REFERENCES TBgrupo (idGrupo);
ALTER TABLE TBrelacion ADD CONSTRAINT idcedulaEncargado_fk FOREIGN KEY (CedulaEncargado) REFERENCES TBencargado (CedulaEncargado);
ALTER TABLE TBrelacion ADD CONSTRAINT idcedulaEstudiante_fk FOREIGN KEY (idEstudiante) REFERENCES TBestudiante (idEstudiante);
ALTER TABLE TBProfesor ADD CONSTRAINT fk_idMateria FOREIGN KEY (idMateria) REFERENCES TBMateria (idMateria);
ALTER TABLE TBasistencia ADD CONSTRAINT fk_idEstadoA FOREIGN KEY(idEstado) REFERENCES TBestado(idEstado);
ALTER TABLE TBcontacto ADD CONSTRAINT fk_IDestudiante1 foreign KEY(idEstudiante) REFERENCES TBeSTUDIANTE(idEstudiante);
ALTER TABLE TBcontacto ADD CONSTRAINT fk_IDEncargado1 foreign KEY(idEncargado) REFERENCES TBencargado(cedulaencargado);





--Creaci+on de Tablas de AUDITORIAS


CREATE TABLE AUDITORIAS_contacto(
idContacto NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
tabla VARCHAR2(25) NOT NULL,
accion VARCHAR2(15) NOT NULL,
usuario VARCHAR2(35),
fecha DATE NOT NULL,
CONSTRAINT pk_idContactoAU PRIMARY KEY(idContacto));


CREATE TABLE AUDITORIAS_correoEstudiante(
idCorreoEstudiante NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
tabla VARCHAR2(25) NOT NULL,
accion VARCHAR2(15) NOT NULL,
usuario VARCHAR2(35),
fecha DATE NOT NULL,
CONSTRAINT pk_idCorreoEstudianteAU PRIMARY KEY(idCorreoEstudiante));


CREATE TABLE AUDITORIAS_encargado(
idEncargado NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
tabla VARCHAR2(25) NOT NULL,
accion VARCHAR2(15) NOT NULL,
usuario VARCHAR2(35),
fecha DATE NOT NULL,
CONSTRAINT pk_idEncargadoAU PRIMARY KEY(idEncargado));


CREATE TABLE AUDITORIAS_estado(
idEstado NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
tabla VARCHAR2(25) NOT NULL,
accion VARCHAR2(15) NOT NULL,
usuario VARCHAR2(35),
fecha DATE NOT NULL,
CONSTRAINT pk_idEstadoAU PRIMARY KEY(idEstado));


CREATE TABLE AUDITORIAS_estudiante(
idEstudiante NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
tabla VARCHAR2(25) NOT NULL,
accion VARCHAR2(15) NOT NULL,
usuario VARCHAR2(35),
fecha DATE NOT NULL,
CONSTRAINT pk_idEstudianteAU PRIMARY KEY(idEstudiante));


CREATE TABLE AUDITORIAS_grupo(
idGrupo NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
tabla VARCHAR2(25) NOT NULL,
accion VARCHAR2(15) NOT NULL,
usuario VARCHAR2(35),
fecha DATE NOT NULL,
CONSTRAINT pk_idGrupoAU PRIMARY KEY(idGrupo));


CREATE TABLE AUDITORIAS_horario(
idHorario NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
tabla VARCHAR2(25) NOT NULL,
accion VARCHAR2(15) NOT NULL,
usuario VARCHAR2(35),
fecha DATE NOT NULL,
CONSTRAINT pk_idHorarioAU PRIMARY KEY(idHorario));


CREATE TABLE AUDITORIAS_materia(
idMateria NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
tabla VARCHAR2(25) NOT NULL,
accion VARCHAR2(15) NOT NULL,
usuario VARCHAR2(35),
fecha DATE NOT NULL,
CONSTRAINT pk_idMateriaAU PRIMARY KEY(idMateria));


CREATE TABLE AUDITORIAS_profesor(
idProfesor NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
tabla VARCHAR2(25) NOT NULL,
accion VARCHAR2(15) NOT NULL,
usuario VARCHAR2(35),
fecha DATE NOT NULL,
CONSTRAINT pk_idProfesorAU PRIMARY KEY(idProfesor));


CREATE TABLE AUDITORIAS_profesoresPorGrupo(
idProfesoresPorGrupo NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
tabla VARCHAR2(25) NOT NULL,
accion VARCHAR2(15) NOT NULL,
usuario VARCHAR2(35),
fecha DATE NOT NULL,
CONSTRAINT pk_idProfesoresPorGrupoAU PRIMARY KEY(idProfesoresPorGrupo));


CREATE TABLE AUDITORIAS_relacion(
idRelacion NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
tabla VARCHAR2(25) NOT NULL,
accion VARCHAR2(15) NOT NULL,
usuario VARCHAR2(35),
fecha DATE NOT NULL,
CONSTRAINT pk_idRelacionAU PRIMARY KEY(idRelacion));


CREATE TABLE AUDITORIAS_sexo(
idSexo NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
tabla VARCHAR2(25) NOT NULL,
accion VARCHAR2(15) NOT NULL,
usuario VARCHAR2(35),
fecha DATE NOT NULL,
CONSTRAINT pk_idSexoAU PRIMARY KEY(idSexo));

